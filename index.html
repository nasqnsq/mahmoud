<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø­Ø§Ø³Ø¨Ø© Ù…Ø­Ù…ÙˆØ¯</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --card: #ffffff;
            --text-main: #0f172a;
            --text-sub: #64748b;
            --danger: #ef4444;
            --success: #22c55e;
            --border: #e2e8f0;
            --warning: #f59e0b;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            background: var(--bg); 
            color: var(--text-main); 
            margin: 0; 
            padding: 15px;
            line-height: 1.5;
        }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .header h2 { margin: 0; font-size: 1.4rem; font-weight: 800; color: var(--primary); }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .stat-card { background: var(--card); padding: 15px; border-radius: 16px; border: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .stat-label { font-size: 0.8rem; color: var(--text-sub); margin-bottom: 5px; }
        .stat-value { font-size: 1.1rem; font-weight: bold; }
        .stat-value.usd { color: var(--primary); }

        .form-card { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid var(--border); margin-bottom: 25px; }
        input, select { width: 100%; padding: 12px 15px; margin-bottom: 12px; border: 1.5px solid var(--border); border-radius: 10px; font-size: 16px; background: #fdfdfd; }
        
        .btn { width: 100%; padding: 14px; border: none; border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn:active { transform: scale(0.98); }
        .btn-main { background: var(--primary); color: white; }
        .btn-sync { background: var(--success); color: white; margin-top: 10px; }
        .btn-ghost { background: #f1f5f9; color: var(--text-sub); padding: 8px 15px; width: auto; font-size: 0.8rem; }

        .tx-item {
            background: var(--card); margin-bottom: 10px; padding: 12px 15px; border-radius: 15px;
            display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border);
        }
        .tx-info b { display: block; font-size: 0.95rem; }
        .tx-info span { font-size: 0.75rem; color: var(--text-sub); }
        .tx-actions { display: flex; gap: 8px; align-items: center; }
        .action-btn { background: none; border: none; font-size: 1.2rem; cursor: pointer; padding: 5px; }

        .income { color: var(--success); }
        .expense { color: var(--danger); }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); align-items: flex-end; z-index: 1000; }
        .modal-content { background: white; width: 100%; padding: 25px; border-radius: 25px 25px 0 0; }

        #status-msg { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 50px; font-size: 0.8rem; display: none; z-index: 2000; }
    </style>
</head>
<body>

<div id="status-msg"></div>

<div class="header">
    <h2>ğŸ“Š Ù…Ø­Ø§Ø³Ø¨ØªÙŠ</h2>
    <button class="btn btn-ghost" onclick="openSettings()">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-label">Ø±ØµÙŠØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±</div>
        <div class="stat-value usd" id="net-usd">0.00 $</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Ø±ØµÙŠØ¯ Ø§Ù„Ù„ÙŠØ±Ø©</div>
        <div class="stat-value" id="net-try">0 â‚º</div>
    </div>
</div>

<div class="form-card">
    <h3 id="form-title" style="margin-top:0; font-size:1rem;">ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ©</h3>
    <input type="hidden" id="edit-id">
    <input type="text" id="desc" placeholder="ÙˆØµÙ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©">
    <input type="number" id="amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" inputmode="decimal">
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <select id="currency">
            <option value="USD">Ø¯ÙˆÙ„Ø§Ø± ($)</option>
            <option value="TRY">Ù„ÙŠØ±Ø© (â‚º)</option>
        </select>
        <select id="type">
            <option value="income">Ø¯Ø®Ù„ (+)</option>
            <option value="expense">Ø®Ø±Ø¬ (-)</option>
        </select>
    </div>
    
    <button class="btn btn-main" id="submit-btn" onclick="saveTransaction()">Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</button>
    <button class="btn btn-sync" onclick="syncWithGitHub()">Ù…Ø²Ø§Ù…Ù†Ø© Ø³Ø­Ø§Ø¨ÙŠØ© â˜ï¸</button>
</div>

<div style="font-weight: bold; margin-bottom: 10px;">Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
<div id="tx-list"></div>

<div id="settingsModal" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub</h3>
        <input type="password" id="gh-token" placeholder="GitHub Token">
        <input type="text" id="gh-owner" placeholder="Username">
        <input type="text" id="gh-repo" placeholder="Repo Name">
        <input type="text" id="gh-path" value="data.json">
        <div style="display:flex; gap:10px;">
            <button class="btn btn-main" style="flex:2" onclick="saveSettings()">Ø­ÙØ¸</button>
            <button class="btn btn-ghost" style="flex:1" onclick="closeSettings()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>
</div>

<script>
    let appData = JSON.parse(localStorage.getItem('mahmoudData')) || { transactions: [] };
    let ghConfig = JSON.parse(localStorage.getItem('ghConfig')) || { token: '', owner: '', repo: '', path: 'data.json' };

    function renderUI() {
        const list = document.getElementById('tx-list');
        list.innerHTML = '';
        let usd = 0, try_val = 0;

        appData.transactions.forEach((tx, index) => {
            if (tx.currency === 'USD') usd += (tx.type === 'income' ? tx.amount : -tx.amount);
            else try_val += (tx.type === 'income' ? tx.amount : -tx.amount);

            const div = document.createElement('div');
            div.className = 'tx-item';
            div.innerHTML = `
                <div class="tx-info">
                    <b>${tx.desc}</b>
                    <span class="${tx.type}">${tx.type === 'income' ? 'Ø¯Ø®Ù„' : 'Ø®Ø±Ø¬'}: ${tx.amount.toLocaleString()} ${tx.currency}</span>
                </div>
                <div class="tx-actions">
                    <button class="action-btn" onclick="editTx(${tx.id})">âœï¸</button>
                    <button class="action-btn" onclick="deleteTx(${tx.id})">ğŸ—‘ï¸</button>
                </div>
            `;
            list.appendChild(div);
        });

        document.getElementById('net-usd').innerText = `${usd.toFixed(2)} $`;
        document.getElementById('net-try').innerText = `${try_val.toLocaleString()} â‚º`;
    }

    function saveTransaction() {
        const id = document.getElementById('edit-id').value;
        const desc = document.getElementById('desc').value;
        const amount = parseFloat(document.getElementById('amount').value);
        if (!desc || isNaN(amount)) return showToast('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!', true);

        const newTx = {
            id: id ? parseInt(id) : Date.now(),
            date: new Date().toISOString(),
            desc, amount,
            currency: document.getElementById('currency').value,
            type: document.getElementById('type').value
        };

        if (id) {
            const idx = appData.transactions.findIndex(t => t.id == id);
            appData.transactions[idx] = newTx;
            showToast('ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„');
        } else {
            appData.transactions.unshift(newTx);
            showToast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©');
        }

        resetForm();
        saveAndRefresh();
    }

    function deleteTx(id) {
        if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ')) {
            appData.transactions = appData.transactions.filter(t => t.id !== id);
            saveAndRefresh();
            showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù');
        }
    }

    function editTx(id) {
        const tx = appData.transactions.find(t => t.id == id);
        document.getElementById('edit-id').value = tx.id;
        document.getElementById('desc').value = tx.desc;
        document.getElementById('amount').value = tx.amount;
        document.getElementById('currency').value = tx.currency;
        document.getElementById('type').value = tx.type;
        document.getElementById('form-title').innerText = "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©";
        document.getElementById('submit-btn').innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†";
        window.scrollTo(0,0);
    }

    function resetForm() {
        document.getElementById('edit-id').value = '';
        document.getElementById('desc').value = '';
        document.getElementById('amount').value = '';
        document.getElementById('form-title').innerText = "ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ©";
        document.getElementById('submit-btn').innerText = "Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©";
    }

    function saveAndRefresh() {
        localStorage.setItem('mahmoudData', JSON.stringify(appData));
        renderUI();
    }

    // Ù…Ù†Ø·Ù‚ GitHub
    async function syncWithGitHub() {
        if (!ghConfig.token) return openSettings();
        showToast('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...');
        try {
            const url = `https://api.github.com/repos/${ghConfig.owner}/${ghConfig.repo}/contents/${ghConfig.path}`;
            const res = await fetch(url, { headers: {'Authorization': `token ${ghConfig.token}`} });
            let sha = null;
            if (res.ok) { const j = await res.json(); sha = j.sha; }
            
            const putRes = await fetch(url, {
                method: 'PUT',
                headers: { 'Authorization': `token ${ghConfig.token}` },
                body: JSON.stringify({
                    message: "sync",
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(appData)))),
                    sha: sha
                })
            });
            if (putRes.ok) showToast('Ù†Ø¬Ø­Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© âœ…');
            else throw new Error();
        } catch (e) { showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©!', true); }
    }

    function openSettings() { document.getElementById('settingsModal').style.display = 'flex'; }
    function closeSettings() { document.getElementById('settingsModal').style.display = 'none'; }
    function saveSettings() {
        ghConfig = {
            token: document.getElementById('gh-token').value,
            owner: document.getElementById('gh-owner').value,
            repo: document.getElementById('gh-repo').value,
            path: document.getElementById('gh-path').value
        };
        localStorage.setItem('ghConfig', JSON.stringify(ghConfig));
        closeSettings();
        showToast('ØªÙ… Ø§Ù„Ø­ÙØ¸');
    }

    function showToast(m, e=false) {
        const t = document.getElementById('status-msg');
        t.innerText = m; t.style.display = 'block'; t.style.background = e ? '#ef4444' : '#2563eb';
        setTimeout(() => t.style.display='none', 2500);
    }

    renderUI();
</script>
</body>
</html>
