<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø­Ø§Ø³Ø¨Ø© Ù…Ø­Ù…ÙˆØ¯</title>
    <style>
        :root {
            --primary: #2563eb; --bg: #f8fafc; --card: #ffffff;
            --text-main: #0f172a; --text-sub: #64748b;
            --danger: #ef4444; --success: #22c55e; --border: #e2e8f0;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: system-ui, sans-serif; background: var(--bg); color: var(--text-main); margin: 0; padding: 15px; }

        /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #login-screen {
            position: fixed; inset: 0; background: var(--primary); display: flex;
            align-items: center; justify-content: center; z-index: 5000; padding: 20px;
        }
        .login-box { background: white; padding: 30px; border-radius: 20px; width: 100%; max-width: 350px; text-align: center; }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
        #app-content { display: none; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .stat-card { background: var(--card); padding: 15px; border-radius: 16px; border: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .form-card { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid var(--border); margin-bottom: 25px; }
        input, select { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid var(--border); border-radius: 10px; font-size: 16px; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; }
        .btn-main { background: var(--primary); color: white; }
        .btn-sync { background: var(--success); color: white; margin-top: 10px; }
        .tx-item { background: var(--card); margin-bottom: 10px; padding: 12px; border-radius: 15px; display: flex; justify-content: space-between; border: 1px solid var(--border); }
        .income { color: var(--success); } .expense { color: var(--danger); }
        #status-msg { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 50px; display: none; z-index: 2000; }
    </style>
</head>
<body>

<div id="status-msg"></div>

<div id="login-screen">
    <div class="login-box">
        <h2 style="color: var(--primary)">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ù…Ø­Ù…ÙˆØ¯</h2>
        <input type="text" id="user-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <input type="password" id="pass-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn btn-main" onclick="checkLogin()">Ø¯Ø®ÙˆÙ„</button>
    </div>
</div>

<div id="app-content">
    <div class="header">
        <h2>ğŸ“Š Ù…Ø­Ø§Ø³Ø¨ØªÙŠ</h2>
        <button onclick="logout()" style="background:none; border:none; color:var(--danger)">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div style="font-size: 0.8rem; color: var(--text-sub)">Ø¯ÙˆÙ„Ø§Ø±</div>
            <div id="net-usd" style="font-weight:bold; color:var(--primary)">0.00 $</div>
        </div>
        <div class="stat-card">
            <div style="font-size: 0.8rem; color: var(--text-sub)">Ù„ÙŠØ±Ø©</div>
            <div id="net-try" style="font-weight:bold">0 â‚º</div>
        </div>
    </div>

    <div class="form-card">
        <input type="hidden" id="edit-id">
        <input type="text" id="desc" placeholder="ÙˆØµÙ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©">
        <input type="number" id="amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" inputmode="decimal">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <select id="currency">
                <option value="USD">Ø¯ÙˆÙ„Ø§Ø± ($)</option>
                <option value="TRY">Ù„ÙŠØ±Ø© (â‚º)</option>
            </select>
            <select id="type">
                <option value="income">Ø¯Ø®Ù„ (+)</option>
                <option value="expense">Ø®Ø±Ø¬ (-)</option>
            </select>
        </div>
        <button class="btn btn-main" id="submit-btn" onclick="saveTransaction()">Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</button>
        <button class="btn btn-sync" onclick="syncWithGitHub()">Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø³Ø­Ø§Ø¨Ø© â˜ï¸</button>
    </div>

    <div id="tx-list"></div>
</div>

<script>
    // Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ø§Ù„ØªÙŠ Ø·Ù„Ø¨Øª Ø¯Ù…Ø¬Ù‡Ø§
    const MY_CREDENTIALS = {
        user: "mahmoud",
        pass: "1234shb",
        gh: {
            token: "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",
            owner: "nasqnsq",
            repo: "shop",
            path: "data.json"
        }
    };

    let appData = JSON.parse(localStorage.getItem('mahmoudData')) || { transactions: [] };

    function checkLogin() {
        const u = document.getElementById('user-input').value;
        const p = document.getElementById('pass-input').value;

        if (u === MY_CREDENTIALS.user && p === MY_CREDENTIALS.pass) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-content').style.display = 'block';
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª GitHub ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            localStorage.setItem('ghConfig', JSON.stringify(MY_CREDENTIALS.gh));
            renderUI();
            showToast('Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ Ù…Ø­Ù…ÙˆØ¯');
        } else {
            alert('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©!');
        }
    }

    function logout() {
        location.reload();
    }

    function renderUI() {
        const list = document.getElementById('tx-list');
        list.innerHTML = '';
        let usd = 0, try_val = 0;

        appData.transactions.forEach((tx) => {
            if (tx.currency === 'USD') usd += (tx.type === 'income' ? tx.amount : -tx.amount);
            else try_val += (tx.type === 'income' ? tx.amount : -tx.amount);

            const div = document.createElement('div');
            div.className = 'tx-item';
            div.innerHTML = `
                <div>
                    <b>${tx.desc}</b><br>
                    <small class="${tx.type}">${tx.type === 'income' ? 'Ø¯Ø®Ù„' : 'Ø®Ø±Ø¬'}: ${tx.amount} ${tx.currency}</small>
                </div>
                <div>
                    <button onclick="editTx(${tx.id})" style="border:none; background:none">âœï¸</button>
                    <button onclick="deleteTx(${tx.id})" style="border:none; background:none">ğŸ—‘ï¸</button>
                </div>
            `;
            list.appendChild(div);
        });
        document.getElementById('net-usd').innerText = `${usd.toFixed(2)} $`;
        document.getElementById('net-try').innerText = `${try_val.toLocaleString()} â‚º`;
    }

    function saveTransaction() {
        const id = document.getElementById('edit-id').value;
        const desc = document.getElementById('desc').value;
        const amount = parseFloat(document.getElementById('amount').value);
        if (!desc || isNaN(amount)) return;

        const tx = { id: id ? parseInt(id) : Date.now(), date: new Date().toISOString(), desc, amount, currency: document.getElementById('currency').value, type: document.getElementById('type').value };

        if (id) {
            const idx = appData.transactions.findIndex(t => t.id == id);
            appData.transactions[idx] = tx;
        } else {
            appData.transactions.unshift(tx);
        }
        localStorage.setItem('mahmoudData', JSON.stringify(appData));
        resetForm(); renderUI(); showToast('ØªÙ… Ø§Ù„Ø­ÙØ¸');
    }

    function deleteTx(id) {
        if(confirm('Ø­Ø°ÙØŸ')) { appData.transactions = appData.transactions.filter(t => t.id !== id); localStorage.setItem('mahmoudData', JSON.stringify(appData)); renderUI(); }
    }

    function editTx(id) {
        const tx = appData.transactions.find(t => t.id == id);
        document.getElementById('edit-id').value = tx.id;
        document.getElementById('desc').value = tx.desc;
        document.getElementById('amount').value = tx.amount;
        document.getElementById('currency').value = tx.currency;
        document.getElementById('type').value = tx.type;
        window.scrollTo(0,0);
    }

    function resetForm() { document.getElementById('edit-id').value = ''; document.getElementById('desc').value = ''; document.getElementById('amount').value = ''; }

    async function syncWithGitHub() {
        const conf = JSON.parse(localStorage.getItem('ghConfig'));
        showToast('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...');
        try {
            const url = `https://api.github.com/repos/${conf.owner}/${conf.repo}/contents/${conf.path}`;
            const res = await fetch(url, { headers: {'Authorization': `token ${conf.token}`} });
            let sha = null;
            if (res.ok) {
                const j = await res.json(); sha = j.sha;
                appData = JSON.parse(decodeURIComponent(escape(atob(j.content))));
                localStorage.setItem('mahmoudData', JSON.stringify(appData));
                renderUI();
            }
            await fetch(url, {
                method: 'PUT',
                headers: { 'Authorization': `token ${conf.token}` },
                body: JSON.stringify({ message: "sync", content: btoa(unescape(encodeURIComponent(JSON.stringify(appData)))), sha: sha })
            });
            showToast('ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…');
        } catch (e) { showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', true); }
    }

    function showToast(m, e=false) {
        const t = document.getElementById('status-msg'); t.innerText = m; t.style.display = 'block';
        t.style.background = e ? '#ef4444' : '#333'; setTimeout(() => t.style.display='none', 2500);
    }
</script>
</body>
</html>
